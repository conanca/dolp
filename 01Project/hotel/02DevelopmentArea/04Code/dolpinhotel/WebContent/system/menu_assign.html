<script type="text/javascript">
$(function(){
	$("input:button,input:submit,input:reset").button();
	
	//欲分配菜单的角色ID
	var roleId;
	
	$("#menuAssignList").jqGrid({
	   	rowNum:10,
	   	rowList:[10,20,30],
	   	height: "100%",
	   	datatype: "json",
	    jsonReader:{
	   		repeatitems: false
        },
	    viewrecords: true,
	    loadComplete: function(){
			$.addMessage($(this).getUserData());
    	},
	    caption:"角色列表",
	   	url:'system/role/getGridData?isOrgaRela=0',
	   	colNames:['id','名称','描述'],
	   	colModel:[
	   		{name:'id',index:'id', width:0,hidden:true},
	   		{name:'name',index:'name', width:100},
	   		{name:'description',index:'description', width:300}
	   	],
	   	pager: '#menuAssignPager',
	   	sortname: 'id',
	    sortorder: "asc",
    	onSelectRow: function(id){
    		$("#menuList").setGridParam({url:"system/menu/getMenuByRoleId/"+id,page:1});
			$("#menuList").trigger('reloadGrid');
			roleId = id;
        }
	});
	$("#menuAssignList").navGrid('#menuAssignPager',{edit:false,add:false,del:false,search:false});

	$("#menuList").jqGrid({
		height: "auto",
		treeGrid: true,
		treeGridModel: 'nested',
		pager: false,
		ExpandColumn: "name",
		ExpandColClick: true,
		treeIcons: {leaf:'ui-icon-document-b'},
		datatype: "json",
	    jsonReader:{
	   		repeatitems: false
        },
	    loadComplete: function(){
			$.addMessage($(this).getUserData());
		},
		rowNum: 200,
		caption: "可见菜单列表",
		url: "system/menu/getMenuByRoleId/0",
		colNames: ["id","功能菜单","url","描述","已分配"],
		colModel: [
			{name: "id",index:"id", width:0,hidden:true,key:true},
			{name: "name",index:"name", width:150, resizable: false, sortable:false},
			{name: "url",index:"url", width:0,hidden:true},
			{name: "description",index:"description", width:200},
			{name: 'visible', index:'visible', width: 60, align:'center', formatter:'checkbox', formatoptions:{disabled:false}, editoptions:{value:'1:0'}}
		],
		pager: '#menuPager'
	});

	$("#menuAssignBtn").click(function() {
		var selectedMenu = $("#menuList").getCol('visible',true);
		var selectedMenuIds = new Array();;
		var i=0;
        $.each(selectedMenu, function(k, v) {
            if(v.value==1){
            	selectedMenuIds[i]=v.id;
				i++;
            }
        });
		var url = "system/role/assignMenu";
		$.dolpPost(url,{roleId:roleId,selectedMenuIds:selectedMenuIds})
	});
});
</script>
<table>
	<tr>
		<td valign="top">
			<table id="menuAssignList"></table>
			<div id="menuAssignPager"></div>
		</td>
		<td valign="top">
			<table id="menuList"></table>
			<div id="menuPager"></div>
		</td>
		<td valign="top">
			<input type="button" value="分配" id="menuAssignBtn"/>
		</td>
	</tr>
</table>