<script type="text/javascript">
$(function(){
	$("input:button,input:submit,input:reset").button();

	//------------------设为同步模式------------------
	$.ajaxSetup({ async: false});
	// 查询出所有的房间类型
	var allRoomTypes = $.dolpGet("dolpinhotel/setup/roomtype/getAllRoomTypeMap");
	$("#room_manage_roomTypeId").addItems(allRoomTypes);
	var allRoomTypes1 = $.swapJSON(allRoomTypes);
	$.ajaxSetup({ async: true});
	//------------------设回异步模式------------------

	$("#roomList").jqGrid({
		jsonReader:{
			repeatitems: false
		},
		caption: "房间列表",
		url:'dolpinhotel/setup/room/getJqgridData',
		editurl: "dolpinhotel/setup/room/editRow",
		datatype: "json",
		colNames:['id','房间号', '房间类型','已入住'],
		colModel:[
			{name:'id',index:'id', width:0,editable:true,hidden:true},
			{name:'number',index:'number', width:100, editable:true,editrules:{required:true}},
			{name:'roomTypeId',index:'roomTypeId', width:100, editable:true, edittype:'select', formatter:'select', editoptions:{value:allRoomTypes1}},
			{name:'isOccupancy',index:'isOccupancy', width:100, editable:true, edittype:'select', formatter:'select', editoptions:{value:"false:否;true:是"}},
		],
		pager: '#roomPager',
		sortname: 'number',
		sortorder: "asc",
		multiselect: true
	});
	//开启jqgrid自带的增删改功能
	$("#roomList").setJqGridCUD('#roomPager',{edit:true,add:true,del:true,search:false});
	//添加自定义按钮——导出Excel
	$("#roomList").export2Excel('#roomPager');
	//查询按钮点击事件
	$("#roomSerchForm").submit(function() {
		var number = $("#room_manage_number").val();
		var isOccupancy = $("#room_manage_isOccupancy").val();
		var roomTypeId = $("#room_manage_roomTypeId").val();
		url = "dolpinhotel/setup/room/getJqgridData?number="+number+"&isOccupancy="+isOccupancy+"&roomTypeId="+roomTypeId;
		$("#roomList").setGridParam({url:url, page:1}).trigger("reloadGrid");
		return false;
	});
});
</script>

<fieldset>
<legend>房间查询</legend>
<form id="roomSerchForm" action="#">
<table>
	<tr>
		<td>
			房间号：
		</td>
		<td>
			<input type="text" name="number" id="room_manage_number"/>
		</td>
		<td>
			已入住：
		</td>
		<td>
			<select name="isOccupancy" id="room_manage_isOccupancy">
				<option value="" selected="selected"></option>
				<option value="false">否</option>
				<option value="true">是</option>
			</select>
		</td>
		<td>
			房间类型：
		</td>
		<td>
			<select name="roomTypeId" id="room_manage_roomTypeId">
				<option value="-1" selected="selected"></option>
			</select>
		</td>
	</tr>
	<tr>
		<td colspan="6" align="right">
			<input type="submit" value="查询"/>
		</td>
	</tr>
</table>
</form>
</fieldset>
<br/>
<table id="roomList"></table>
<div id="roomPager"></div>